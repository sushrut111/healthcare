if (self.CavalryLogger) { CavalryLogger.start_js(["BQgbz"]); }

__d('NotificationComponentsBootloader',['Promise','JSResource'],(function a(b,c,d,e,f,g){'use strict';var h=[c('JSResource')('NotificationList.react').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationJewelList.react').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationAsyncWrapper').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationSeenState').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationStore').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationUpdates').__setRef('NotificationComponentsBootloader'),c('JSResource')('NotificationJewelController').__setRef('NotificationComponentsBootloader')];function i(){return new (c('Promise'))(function(j){c('JSResource').loadAll(h,function(k,l,m){j([k,l,m])})})}f.exports={load:i}}),null);
__d('NotificationAttachmentUtils',['NotificationAttachmentConfig'],(function a(b,c,d,e,f,g){'use strict';var h={shouldOpenSnowlift:function i(j){var k=j.attachments,l=j.feedback_context,m=j.attached_story,n=[];if(k)n.push.apply(n,k);if(l&&l.relevant_comments){var o=l.relevant_comments;o.reduce(function(p,q){return p.concat(q.attachments)},n)}if(m&&m.attachments)n.push.apply(n,m.attachments);return n.some(function(p){if(!p.style_list||!p.style_list.length)return false;var q=p.style_list[0];return !!c('NotificationAttachmentConfig').snowliftStyles[q]})}};f.exports=h}),null);
__d("NotificationConstants",[],(function a(b,c,d,e,f,g){f.exports={PayloadSourceType:{UNKNOWN:0,USER_ACTION:1,LIVE_SEND:2,ENDPOINT:3,INITIAL_LOAD:4,OTHER_APPLICATION:5,SYNC:6,CLIENT:7}}}),null);
__d('NotificationEndpointState',['BusinessUserConf','KeyedCallbackManager','RangedCallbackManager','flatMapArray','objectValues','stableStringify'],(function a(b,c,d,e,f,g){h.getInstance=function(i){'use strict';var j=i.classification!=null?i.classification:'_',k=i.filter!=null?i.filter:'_',l='(f)'+k+'(c)'+j,m=h.$NotificationEndpointState1[i.endpointURI];if(m==null)h.$NotificationEndpointState1[i.endpointURI]=m={};if(m[l]==null)m[l]=new h(i);return m[l]};h.getAllInstances=function(i){'use strict';var j=void 0;if(i!=null){j=[i]}else j=Object.keys(h.$NotificationEndpointState1);return c('flatMapArray')(j,function(k){var l=h.$NotificationEndpointState1[k];if(l==null){return []}else return c('objectValues')(l);})};function h(i){var j=i.businessUserID,k=i.classification,l=i.endpointURI,m=i.filter;'use strict';this.notifications=new (c('KeyedCallbackManager'))();this.businessUserID=j!=null?j:c('BusinessUserConf').businessUserID;this.classification=k;this.endpointURI=l;this.filter=m;var n=function o(p){var q=this.notifications.getResource(p);return q.creation_time};this.order=new (c('RangedCallbackManager'))(n.bind(this),function(o,p){return p-o});this.graphQLPageInfo=null}h.prototype.getConfig=function(){'use strict';return {businessUserID:this.businessUserID,classification:this.classification,endpointURI:this.endpointURI,filter:this.filter}};h.prototype.getHash=function(){'use strict';return c('stableStringify')(this.getConfig())};h.prototype.getRequestParams=function(i){'use strict';var j=Math.max(0,i-this.order.getAllResources().length);return {businessUserID:this.businessUserID,classification:this.classification,cursor:this.graphQLPageInfo&&this.graphQLPageInfo.end_cursor,filter:this.filter,length:j}};h.$NotificationEndpointState1={};f.exports=h}),null);
__d('NotificationPhotoThumbnail',['NotificationAttachmentConfig'],(function a(b,c,d,e,f,g){'use strict';function h(j){if(!j.media||!j.style_list||!j.style_list.length)return null;var k=j.style_list[0];if(c('NotificationAttachmentConfig').thumbnailStyles[k])return j.media.image;return null}var i={getThumbnailForNotification:function j(k){var l=k.attachments,m=k.attached_story,n=k.feedback_context;return i.getThumbnail(l,m,n)},getThumbnail:function j(k,l,m){var n=void 0;if(k&&k.length){k.some(function(r){n=h(r);if(n)return true;return false});if(n)return n;}if(m){var o=m.relevant_comments;if(o&&o.length){var p=o[0].attachments;if(p&&p.length){n=h(p[0]);if(n)return n;}}}if(l){var q=l.attachments;if(q&&q.length)return h(q[0]);}return null}};f.exports=i}),null);
__d('NotificationURI',['BusinessURI.brands','URI','VideoPermalinkURI','isFacebookURI'],(function a(b,c,d,e,f,g){var h={localize:function i(j){try{j=c('BusinessURI.brands')(j)}catch(l){return j.toString()}var k=j.getSubdomain();return j.getUnqualifiedURI().getQualifiedURI().setSubdomain(k).toString()},snowliftable:function i(j){if(!j)return false;var k=new (c('URI'))(j),l=k.getQueryData();return c('isFacebookURI')(k)&&(c('VideoPermalinkURI').isValid(k)||'fbid' in l)},isVaultSetURI:function i(j){return this._areEquals(j,'/ajax/vault/sharer_preview.php')},isAlbumDraftRecoveryDialogURI:function i(j){return this._areEquals(j,'/ajax/photos/upload/overlay/')},isQuicksilverURI:function i(j){return this._areEquals(j,'/games/quicksilver/spotlight/')},isDirectURI:function i(j){return this._startsWith(j,'/direct/')},isIGAccountCreationURI:function i(j){return this._areEquals(j,'/ads/growth/aymt/instagram/account-creation-dialog/')},_areEquals:function i(j,k){if(!j)return false;var l=new (c('URI'))(j);return c('isFacebookURI')(l)&&l.getPath()===k},_startsWith:function i(j,k){if(!j)return false;var l=new (c('URI'))(j);return c('isFacebookURI')(l)&&l.getPath().startsWith(k)}};f.exports=h}),null);
__d('NotificationUtils',['NotificationAttachmentUtils','NotificationURI','URI'],(function a(b,c,d,e,f,g){'use strict';function h(l){return !!(l&&l.can_render_in_tahoe)}function i(l){return !!(l&&l.bucket_data)}function j(l){return !!(l&&l.video_channel_id)&&!h(l)}var k={getLinkProps:function l(m){var n=c('NotificationURI').localize(new (c('URI'))(m.url)),o=n;if(j(m.rendererData)||h(m.rendererData)||i(m.rendererData))return {href:o};var p=c('NotificationAttachmentUtils').shouldOpenSnowlift(m)&&c('NotificationURI').snowliftable(n),q=c('NotificationURI').isAlbumDraftRecoveryDialogURI(n),r=p||q?n:m.ajaxify_url||'',s=null;if(p){s='theater'}else if(q){s='async-post'}else if(c('NotificationURI').isQuicksilverURI(r)||c('NotificationURI').isIGAccountCreationURI(r)){s='dialog-post'}else if(c('NotificationURI').isDirectURI(n)){s='async'}else if(r)s='dialog';return {ajaxify:r,href:o,rel:s}}};f.exports=k}),null);
__d('normalizeNotificationPayload',['ix','NotificationPhotoThumbnail','NotificationUtils','idx'],(function a(b,c,d,e,f,g,h){'use strict';function i(j){var k;if(Array.isArray(j.eligible_buckets))j.eligible_buckets=j.eligible_buckets.map(function(u){return u.toUpperCase()});if(Object.prototype.hasOwnProperty.call(j,'menu_options')){var l=j,m=l.menu_options;delete l.menu_options;j.notif_option_sets={edges:m&&[{node:{notif_options:{edges:m&&m.map(function(u){return {node:{client_info:{action_type:u.client_action,undo_server_action:u.undo_server_action},server_action:u.server_action,option_display:{text:{text:u.text},subtext:u.subtext!=null?{text:u.subtext}:null,undo_text:u.undo_text}}}})}}}]}}if(Object.prototype.hasOwnProperty.call(j,'previewImage')===false){var n=j,o=c('NotificationPhotoThumbnail').getThumbnailForNotification(n);j.previewImage=o}if(Object.prototype.hasOwnProperty.call(j,'primerAttributes')===false){var p=j,q=c('NotificationUtils').getLinkProps(p);j.primerAttributes={ajaxify:q.ajaxify===undefined?undefined:q.ajaxify,rel:q.rel};delete p.ajaxify_url}if(Object.prototype.hasOwnProperty.call(j,'renderer_data')===false)(function(){var u=j,v=u.rendererData;if(v&&(Object.prototype.hasOwnProperty.call(v,'bucket_data')||Object.prototype.hasOwnProperty.call(v,'bucket_id')||Object.prototype.hasOwnProperty.call(v,'can_render_in_tahoe')||Object.prototype.hasOwnProperty.call(v,'owner_id')||Object.prototype.hasOwnProperty.call(v,'sender_id')||Object.prototype.hasOwnProperty.call(v,'time_to_hide')||Object.prototype.hasOwnProperty.call(v,'video_channel_caller')||Object.prototype.hasOwnProperty.call(v,'video_channel_id')||Object.prototype.hasOwnProperty.call(v,'video_id'))||u.notif_type==='live_video_explicit'||u.notif_type==='live_video_share'||u.notif_type==='live_video'||u.notif_type==='live_with_video_explicit'||u.notif_type==='live_with_video'){j.renderer_data=babelHelpers['extends']({__typename:'LiveVideoNotificationRendererData'},v,{beeper_time_to_hide:v==null?null:v.time_to_hide,bucket_data:v==null?null:function(){try{return JSON.stringify(v.bucket_data)}catch(x){return null}}()})}else if(u.notif_type==='accept_gifted_game'||u.notif_type==='app_content_update'||u.notif_type==='app_invite'||u.notif_type==='app_notification'||u.notif_type==='app_request'||u.notif_type==='decline_gifted_game'||u.notif_type==='send_game_as_gift'){var w=u.app_request_ids;j.renderer_data={__typename:'AppRequestNotificationRendererData',app_request_ids:w?w.split(','):[]}}else j.renderer_data={__typename:'FallbackNotificationRendererData',should_log_menu_exposure:!!(v&&v.logMenuExposure)};})();if(Object.prototype.hasOwnProperty.call(j,'thumbnail')===false){var r,s=j,t=(r=s)!=null?(r=r.actors)!=null?(r=r[0])!=null?(r=r.profile_picture)!=null?r.uri:r:r:r:r;j.thumbnail={uri:t==null?h("97000"):t}}return j}f.exports=i}),null);
__d('normalizeNotificationUpdatePayload',['normalizeNotificationPayload'],(function a(b,c,d,e,f,g){'use strict';function h(i){i=i;if(i.nodes!=null&&Array.isArray(i.nodes))i.nodes=i.nodes.map(c('normalizeNotificationPayload'));return i}f.exports=h}),null);
__d('once',[],(function a(b,c,d,e,f,g){'use strict';function h(j){var k=i(j);for(var l in j)if(Object.prototype.hasOwnProperty.call(j,l))k[l]=j[l];return k}function i(j){var k=j,l=void 0,m=function n(){if(k){l=k.apply(this,arguments);k=null}return l};return m}f.exports=h}),null);
__d('NotificationServerTransport',['invariant','AjaxPipeRequest','DOM','compactArray','ifRequired','normalizeNotificationUpdatePayload','once','promiseFinally','setImmediateAcrossTransitions','uniqueID'],(function a(b,c,d,e,f,g,h){'use strict';var i={},j={},k={},l={};function m(w){if(l[w]==null){l[w]=c('DOM').create('div',{'class':'hidden_elem',id:w});c('DOM').appendContent(document.documentElement,l[w])}return l[w].id}function n(w){return w.reduce(function(x,y){var z=y.targetNumToLoad;return Math.max(x,z)},0)}function o(w,x,y,z){var aa=i[x];if(!aa)return;if(aa.clientRequestID!==w)return;delete i[x];aa.calls.forEach(function(ba){var ca=ba.onError;if(ca)ca(z);});if(j[x]!=null)q(y);}function p(w,x){var y=x.getHash(),z=i[y];if(!z)return;if(z.clientRequestID!==w)return;delete i[y];z.calls.forEach(function(aa){var ba=aa.onCompleted;if(ba)ba();});if(j[y]!=null)q(x);}function q(w){var x=w.getHash();if(k[x]!=null)return;k[x]=c('setImmediateAcrossTransitions')(function(){delete k[x];var y=c('uniqueID')(),z=j[x];delete j[x];if(z==null)return;var aa=n(z),ba=w.getRequestParams(aa);if(ba.length<=0){z.forEach(function(fa){var ga=fa.onCompleted;if(ga)ga();});return}var ca=o.bind(this,y,x,w),da=p.bind(this,y,w),ea=new (c('AjaxPipeRequest'))('/ajax/pagelet/generic.php/WebNotificationsPayloadPagelet',{data:JSON.stringify(babelHelpers['extends']({},ba,{clientRequestID:y}))}).setAllowCrossPageTransition(true).setAllowIrrelevantRequests(true).setAutomatic(false).setCanvasId(m(y)).setErrorHandler(ca).setFinallyHandler(da).setJSNonBlock(true).setTransportErrorHandler(ca);i[x]={calls:z,clientRequestID:y,transport:ea};ea.send()}.bind(this))}var r={makeRequest:function w(x,y,z){var aa=z.onChunkResponse,ba=z.onCompleted,ca=z.onError,da=x.getHash(),ea={onChunkResponse:aa,onCompleted:ba,onError:ca,targetNumToLoad:y};v(da);var fa=i[da],ga=fa?n(fa.calls)>=y:false;if(ga){fa!=null||h(0);fa.calls.push(ea)}else{if(j[da]==null)j[da]=[];j[da].push(ea);if(fa==null)q(x);}return {remove:function ha(){var ia=i[da];if(ia!=null){var ja=ia.calls.indexOf(ea);if(ja!==-1)ia.calls.splice(ja,1);if(ia.calls.length===0){if(ia.transport)ia.transport.abandon();delete i[da];if(j[da]!=null)q(x);}}var ka=j[da];if(ka!=null){var la=ka.indexOf(ea);if(la!==-1)ka.splice(la,1);}}}},handleResponseChunk:function w(x,y){var z=s(x);z.forEach(function(aa){aa(c('normalizeNotificationUpdatePayload')(y))})}};function s(w){var x=Object.keys(i).find(function(ba){var ca=i[ba];return ca&&ca.clientRequestID===w}),y=x&&i[x];if(!y||!x)return [];var z=y.calls,aa=j[x];if(aa)z=z.concat(aa);return c('compactArray')(z.map(function(ba){return ba.onChunkResponse}))}function t(w,x){var y=x.targetNumToLoad,z=x.endpointState,aa=x.payloadPromise;if(i[w]!=null)return;var ba=c('uniqueID')(),ca={calls:[{targetNumToLoad:y}],clientRequestID:ba};i[w]=ca;var da=aa.then(function(ea){var fa=s(ba);fa.forEach(function(ga){ga(ea)})});c('promiseFinally')(da,function(){p(ba,z)}).done()}var u=function w(x){c('ifRequired')('NotificationEagerLoader',function(y){var z=y.eagerlyLoadedData;if(z.hasData&&x===z.endpointState.getHash())t(x,z);})},v=c('once')(u);f.exports=r}),null);
__d('NotificationServerTransportLegacy',['AsyncRequest','normalizeNotificationUpdatePayload'],(function a(b,c,d,e,f,g){'use strict';var h={makeRequest:function i(j,k,l){var m=l.onError,n=l.onChunkResponse,o=l.onCompleted,p=true;function q(u){if(!p)return;var v=c('normalizeNotificationUpdatePayload')(u.getPayload());try{n(v)}finally{o()}}function r(u){if(!p)return;if(m)m(u);}var s=j.getRequestParams(k);if(s.length<=0){o();return {remove:function u(){}}}var t=new (c('AsyncRequest'))(j.endpointURI).setAllowCrossPageTransition(true).setData(s).setErrorHandler(r).setTransportErrorHandler(r).setHandler(q);t.send();return {remove:function u(){p=false;t.abandon()}}}};f.exports=h}),null);
__d('NotificationsDefaultEndpointURI',[],(function a(b,c,d,e,f,g){'use strict';f.exports='/ajax/notifications/client/get.php'}),null);
__d('sortBy',[],(function a(b,c,d,e,f,g){'use strict';function h(i,j){var k=i.map(function(l,m){return {index:m,sortValue:j(l),value:l}});k.sort(function(l,m){var n=l.sortValue,o=m.sortValue;if(n>o)return 1;if(n<o)return -1;return l.index-m.index});return k.map(function(l){return l.value})}f.exports=h}),null);
__d('NotificationStore',['AsyncFeature','ErrorUtils','NotificationConstants','NotificationEndpointState','NotificationListConfig','NotificationsDefaultEndpointURI','NotificationServerTransport','NotificationServerTransportLegacy','NotificationUpdates','QE2Logger','createObjectBy','distinctArrayBy','flatMapArray','objectValues','sortBy','sprintf'],(function a(b,c,d,e,f,g){var h={};function i(n,o,p){return n.page_info!=null&&o.classification==p.classification&&o.endpointURI===p.endpointURI&&o.filter==p.filter}function j(n,o){var p={};c('NotificationEndpointState').getAllInstances(o.endpointURI).forEach(function(q){var r=void 0;if(i(n,q,o)){q.graphQLPageInfo=n.page_info;r=n}else if(n.payloadsource===c('NotificationConstants').PayloadSourceType.SYNC&&o.endpointURI===c('NotificationsDefaultEndpointURI')&&q.classification==null&&q.filter==null){r=n}else r=babelHelpers['extends']({},n,{nodes:n.nodes?n.nodes.filter(function(t){return k(t,q)}):undefined});if(r.nodes&&r.nodes.length>0){var s=l(q,r);if(s!=null)s.forEach(function(t){p[t]=true});}});c('NotificationUpdates').didUpdateNotifications(Object.keys(p))}function k(n,o){var p=o.classification,q=o.filter,r=o.notifications,s=o.order,t=s.getAllResources();t.length===0;if(t.length>0){var u=t[0],v=r.getResource(u);if(v.creation_time>=n.creation_time)return false;}if(p&&(!n.classifications||!n.classifications.includes(p)))return false;if(q&&q==='read'!==(n.seen_state==='SEEN_AND_READ'))return false;return true}function l(n,o){var p=[],q={};if(o.nodes&&o.nodes.length>0)o.nodes.forEach(function(r){var s=r.alert_id,t=n.notifications.getResource(s);if(!t||t.creation_time<r.creation_time){p.push(s);q[s]=r}});n.notifications.addResourcesAndExecute(q);n.order.addResources(p);return p}c('NotificationUpdates').subscribe('update-notifications',function(n,o){if(o.payloadsource!==c('NotificationConstants').PayloadSourceType.ENDPOINT)j(o,{endpointURI:o.endpoint!=null?o.endpoint:c('NotificationsDefaultEndpointURI')});});var m={getNotifications:function n(o,p,q){var r=c('NotificationEndpointState').getInstance(p),s=r.notifications,t=r.order,u=void 0,v=t.executeOrEnqueue(0,o,function(ea){if(q){u=s.executeOrEnqueue(ea,q);var fa=s.getUnavailableResources(u);if(fa.length>0)c('ErrorUtils').reportError(new Error(c('sprintf')('The range for this endpoint contained notification IDs '+'for which we have no payload (Notification IDs: `%s`. '+'Endpoint config: `%s`).',JSON.stringify(fa),JSON.stringify(r.getConfig()))));}});function w(){t.unsubscribe(v);if(u)s.unsubscribe(u);}if(t.getUnavailableResources(v).length===0)return {remove:w};if(!m.canFetchMore(p)){t.forceRunCallbacks();return {remove:w}}var x=r.getHash();if(h[x]==null){h[x]=1}else h[x]++;function y(){h[x]--;if(h[x]===0)t.forceRunCallbacks();}function z(ea){if(!(ea&&ea.nodes))return;c('NotificationUpdates').handleUpdate(c('NotificationConstants').PayloadSourceType.ENDPOINT,ea,p.filter,p.classification);j(babelHelpers['extends']({},ea,{payloadsource:c('NotificationConstants').PayloadSourceType.ENDPOINT}),p)}function aa(){h[x]--;if(h[x]===0)t.forceRunCallbacks();}var ba=void 0;if(p.endpointURI===c('NotificationsDefaultEndpointURI')&&c('AsyncFeature').__serverHasFeatureImpl(8)&&c('NotificationListConfig').useStreamingTransport){ba=c('NotificationServerTransport')}else ba=c('NotificationServerTransportLegacy');if(p.endpointURI===c('NotificationsDefaultEndpointURI')&&c('AsyncFeature').__serverHasFeatureImpl(8))c('QE2Logger').logExposureForUser('www_notifications_perf_h2_2017');var ca=ba.makeRequest(r,o,{onChunkResponse:z,onCompleted:aa,onError:y}),da=ca.remove;return {remove:function ea(){w();da()}}},getNotification:function n(o){var p=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],q=p.classification,r=p.endpointURI,s=r===undefined?c('NotificationsDefaultEndpointURI'):r,t=p.filter,u=c('NotificationEndpointState').getInstance({classification:q,endpointURI:s,filter:t}),v=u.notifications;return v.getResource(o)},getAllForAllEndpoints:function n(){var o=c('NotificationEndpointState').getAllInstances(),p=c('flatMapArray')(o,function(t){var u=this.getAll(t.getConfig());return c('objectValues')(u)}.bind(this)),q=c('sortBy')(p,function(t){return t.creation_time}),r=q.reverse(),s=c('distinctArrayBy')(r,function(t){return t.alert_id});return c('createObjectBy')(s,function(t){return t.alert_id})},getAll:function n(o){var p=c('NotificationEndpointState').getInstance(o),q=p.notifications,r=p.order,s={};r.getAllResources().forEach(function(t){var u=q.getResource(t);if(u==null){c('ErrorUtils').reportError(new Error(c('sprintf')('The range for this endpoint contained a notification ID for '+'which we have no payload (Notification ID: `%s`. Endpoint '+'config: `%s`).',t,JSON.stringify(o))))}else s[t]=u;});return s},getCount:function n(o){var p=c('NotificationEndpointState').getInstance(o);return p.order.getAllResources().length},canFetchMore:function n(o){var p=c('NotificationEndpointState').getInstance(o),q=p.graphQLPageInfo;return !q||!Object.prototype.hasOwnProperty.call(q,'has_next_page')||q.has_next_page},registerEndpoint:function n(o){c('NotificationEndpointState').getInstance(o)}};m.registerEndpoint({endpointURI:c('NotificationsDefaultEndpointURI')});f.exports=m}),null);
__d('NotificationTokens',['CurrentUser'],(function a(b,c,d,e,f,g){var h={tokenizeIDs:function i(j){return j.map(function(k){return c('CurrentUser').getID()+':'+k})},untokenizeIDs:function i(j){return j.map(function(k){return k.split(':')[1]})}};f.exports=h}),null);
__d('NotificationUpdates',['Arbiter','AsyncRequest','BusinessUserConf','ChannelConstants','JSLogger','LiveTimer','NotificationConstants','NotificationTokens','createObjectFrom','normalizeNotificationUpdatePayload','NotificationStore'],(function a(b,c,d,e,f,g){var h={},i={},j={},k={},l=false,m=[],n=0,o=void 0,p=new (c('Arbiter'))(),q=c('JSLogger').create('notification_updates');function r(){if(n)return;var w=h,x=i,y=j,z=k;h={};i={};j={};k={};if(Object.keys(w).length||l){l=false;t('notifications-updated',w)}if(Object.keys(x).length)t('seen-state-updated',x);if(Object.keys(y).length)t('read-state-updated',y);if(Object.keys(z).length)t('hidden-state-updated',z);m.pop()}function s(){if(m.length)return m[m.length-1];return c('NotificationConstants').PayloadSourceType.UNKNOWN}function t(event,w){v.inform(event,{updates:w,source:s()})}var u=null,v={getserverTime:function w(){return u},setEndPoint:function w(x){o=x},handleUpdate:function w(x,y,z,aa){y=c('normalizeNotificationUpdatePayload')(y);if(y.nodes&&Array.isArray(y.nodes))y.nodes=this._filterNodesBasedOnBusinessUser(y.nodes,c('BusinessUserConf').businessUserID);if(y.servertime){u=y.servertime;c('LiveTimer').restart(y.servertime)}var ba=y.nodes;if(o&&x===c('NotificationConstants').PayloadSourceType.LIVE_SEND&&ba&&Array.isArray(ba)&&ba.length>0){var ca=c('NotificationStore'),da={classification:aa,endpointURI:o,filter:z};if(ca.getCount(da)>0||!ca.canFetchMore(da))return;new (c('AsyncRequest'))(o).setAllowCrossPageTransition(true).setData({businessUserID:c('BusinessUserConf').businessUserID,classification:aa,filter:z,length:ba.length}).setHandler(function(ea){var fa=ea.getPayload();if(fa==null)return;var ga=fa.nodes;if(ga==null||ga.length===0)return;var ha={};ga.forEach(function(ia){var ja=ia.alert_id;ha[ja]=true});fa.nodes=ba.filter(function(ia){var ja=ia.alert_id;return ha[ja]===true});if(fa.nodes.length>0)this._updateWithPayload(x,fa);}.bind(this)).send()}else this._updateWithPayload(x,y);},_updateWithPayload:function w(x,y){if(Object.keys(y).length)this.synchronizeInforms(function(){m.push(x);var z=babelHelpers['extends']({},y,{payloadsource:s()});this.inform('update-notifications',z);this.inform('update-seen',z);this.inform('update-read',z);this.inform('update-hidden',z)}.bind(this));},getArbiter:function w(){return p},inform:function w(event,x){return p.inform(event,x)},subscribe:function w(event,x){return p.subscribe(event,x)},didUpdateNotifications:function w(x){Object.assign(h,c('createObjectFrom')(x));l=true;r()},didUpdateSeenState:function w(x){Object.assign(i,c('createObjectFrom')(x));r()},didUpdateReadState:function w(x){Object.assign(j,c('createObjectFrom')(x));r()},didUpdateHiddenState:function w(x){Object.assign(k,c('createObjectFrom')(x));r()},synchronizeInforms:function w(x){n++;try{x()}catch(y){throw y}finally{n--;r()}},_filterNodesBasedOnBusinessUser:function w(x,y){return x.filter(function(z){return y==z.biz_user_id})}};c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notification_json'),function(w,x){var y=Date.now(),z=x.obj.nodes;if(z){z.forEach(function(ba){ba.receivedTime=y});q.debug('notifications_received',z);var aa=x.obj.servertime;v.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{nodes:z,servertime:aa})}});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notifications_seen'),function(w,x){var y=c('NotificationTokens').tokenizeIDs(x.obj.alert_ids),z=x.obj.new_state;v.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{seenState:c('createObjectFrom')(y,z)})});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notifications_read'),function(w,x){var y=c('NotificationTokens').tokenizeIDs(x.obj.alert_ids),z=x.obj.new_state;v.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{readState:c('createObjectFrom')(y,z)})});c('Arbiter').subscribe(c('ChannelConstants').getArbiterType('notification_hidden'),function(w,x){var y=c('NotificationTokens').tokenizeIDs([x.obj.notif_id+'']),z=x.obj.state===1;v.handleUpdate(c('NotificationConstants').PayloadSourceType.LIVE_SEND,{hiddenState:c('createObjectFrom')(y,z)})});f.exports=v}),null);
__d("NotificationOptionActionWebGraphQLMutation",["WebGraphQLMutationBase"],(function a(b,c,d,e,f,g){'use strict';f.exports=function(){var h,i;h=babelHelpers.inherits(j,c("WebGraphQLMutationBase"));i=h&&h.prototype;j.__getDocID=function(){"use strict";return "1420844941369152"};j.getQueryID=function(){"use strict";return "318967338567215"};function j(){"use strict";h.apply(this,arguments)}return j}()}),null);
__d('NotificationUserActions',['AsyncRequest','Bootloader','BusinessUserConf','CurrentUser','NotificationConstants','NotificationOptionActionWebGraphQLMutation','NotificationTokens','NotificationUpdates','WebGraphQL','createObjectFrom'],(function a(b,c,d,e,f,g){var h=c('NotificationConstants').PayloadSourceType.USER_ACTION,i=false;function j(m){if(c('BusinessUserConf').businessUserID!=null)m.biz_user_id=c('BusinessUserConf').businessUserID;new (c('AsyncRequest'))('/ajax/notifications/mark_read.php').setData(m).setAllowCrossPageTransition(true).send()}function k(m){var n={};m.forEach(function(o,p){n['alert_ids['+p+']']=o});return n}var l={markNotificationsAsSeen:function m(n){var o=document.getElementById('notificationsCountValue'),p=null;if(o)p=o.textContent;c('NotificationUpdates').handleUpdate(h,{seenState:c('createObjectFrom')(n)});var q=c('NotificationTokens').untokenizeIDs(n),r=k(q);r.seen=true;if(p)r.badgeCount=p;j(r)},setNextIsFromReadButton:function m(n){i=n},markNotificationsAsRead:function m(n,o){c('NotificationUpdates').handleUpdate(h,{readState:c('createObjectFrom')(n,true)});var p=c('NotificationTokens').untokenizeIDs(n),q=k(p);if(i){q.from_read_button=true;i=false}if(o)q.source_view=o;j(q)},markNotificationsAsUnread:function m(n,o){c('NotificationUpdates').handleUpdate(h,{readState:c('createObjectFrom')(n,false)});var p=c('NotificationTokens').untokenizeIDs(n),q=k(p);if(i){q.from_read_button=true;i=false}q.unread=true;if(o)q.source_view=o;j(q)},markAllNotificationsAsRead:function m(){c('Bootloader').loadModules(["NotificationSeenState"],function(n){var o=n.getUnreadIDs();if(o.length>0)c('NotificationUpdates').handleUpdate(h,{readState:c('createObjectFrom')(o)});var p={read:true};if(i){p.from_read_button=true;i=false}j(p)},'NotificationUserActions')},sendNotifOption:function m(n){return c('WebGraphQL').exec(new (c('NotificationOptionActionWebGraphQLMutation'))({input:{action_type:n,actor_id:c('BusinessUserConf').businessUserID?''+c('BusinessUserConf').businessUserID:c('CurrentUser').getID(),client_mutation_id:'0'}}))}};f.exports=l}),null);
__d('NotificationJewelReminderLoader',[],(function a(b,c,d,e,f,g){f.exports={init:function h(i,j){i.load().done(function(k){k.init(j)})}}}),null);